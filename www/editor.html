<!DOCTYPE html>
<html>
  <head>
        <meta charset="utf-8">
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
        <meta name="color-scheme" content="light dark">
        <link rel="stylesheet" href="lib/font.css">
        <script src="cordova.js"></script>
        <script src="home.js"></script>
        <style type="text/css">
                body,html,*{
                    margin: 0;
                    box-sizing: border-box;
                }
                * {
                    -webkit-user-select: none;
                    -khtml-user-select: none;
                    -moz-user-select: none;
                    -ms-user-select: none;
                    user-select: none;
                    -webkit-box-sizing: border-box;
                    -moz-box-sizing: border-box;
                    box-sizing: border-box;
                }
                html{
                    width:100%;
                    margin: 0;
                    padding: 0;
                    background-color: transparent;
                    font-family: sans-serif;
                    -ms-text-size-adjust: 100%;
                    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
                }
                body {
                    margin: 0;
                    padding: 0;
                    width: 100%;
                    color: #333;
                    font-weight: 400;
                    background-color: transparent;
                }
                @font-face {
                    font-family: 'Material Icons';
                    font-style: normal;
                    font-weight: 400;
                    src: url(font.woff2) format('woff2');
                }
                .material-icons {
                    font-family: 'Material Icons';
                    font-weight: normal;
                    font-style: normal;
                    font-size: 24px;
                    line-height: 1;
                    letter-spacing: normal;
                    text-transform: none;
                    display: inline-block;
                    white-space: nowrap;
                    word-wrap: normal;
                    direction: ltr;
                    -moz-font-feature-settings: 'liga';
                    -moz-osx-font-smoothing: grayscale;
                }
                footer{
                    padding: 10px;
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    z-index:12;
                    width: 100%;
                    background-color: #fff
                }
                nav{
                    position: relative;
                    float: left;
                    height: 50px;
                    width: 100%;
                }
                nav div{
                    position: relative;
                    float: left;
                    height: 50px;
                    width: calc(100%/3);
                    padding: 10px
                }
                nav .clear input,nav .save input{
                    border-radius: 32px;
                    text-align: center;
                    border: none;
                    width: 32px;
                    height: 32px
                }
                nav .save input{
                    position: relative;
                    float: right;
                    margin-left: 10px
                }
                nav .do input{
                    position: relative;
                    float: left;
                    width: 50%;
                    border-radius: 0;
                    border: none;
                    height: 100%;
                }
                .canvas-holder {
                  position: relative;
                  float: left;
                  width: 100%;
                  height: auto;
                  padding: 5px;
                  align-items: center;
                  background: #eaeaea;
                  display: flex;
                  overflow: auto;
                }

                .canvas-container {
                  position: relative;
                  float: left;
                  width: 100%;
                  height: 100%;
                  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAHUlEQVQ4jWNgYGAQIYAJglEDhoUBg9+FowbQ2gAARjwKARjtnN8AAAAASUVORK5CYII=");
                  background-size: 30px 30px;
                  border: 1px solid #ccc;
                  margin: auto;
                }
                #shapes_panel{
                  background-color: #fff;
                  position: relative;
                  float: left;
                  height: 70px;
                  width: 360px;
                  overflow-y: hidden;
                  overflow-x: auto;
                }
                #shapes_panel .button {
                  position: relative;
                  float: left;
                  padding: 0;
                  width: 32px;
                  height: 32px;
                  display: inline-block;
                  margin: 9px;
                }
                #menu{
                    position: relative;
                    float: left;
                    height: 60px;
                    padding: 5px;
                    display: -webkit-inline-box;
                    overflow-x: auto;
                }
                #kolomInput #input{
                    position: relative;
                    float: left;
                    width: 100%;
                    height: 40px;
                }
                #kolomInput #input span{
                    width: 100%;
                    height: 100%;
                    padding: 10px;
                    display: inline-block;
                    border: 1px solid
                }
                #menu input{
                    position: relative;
                    float: left;
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    border:none;
                    margin-right: 5px
                }
                section{
                    background-color: #fff;
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    z-index: 3;
                    padding: 10px
                }
                .hidden,.hiddens{
                    display: none;
                }
                .show{
                    display: block;
                }
                .scroll{
                    display:  -webkit-inline-box
                }
                #editor{
                    position: relative;
                    width: 100%;
                    float: left;   
                }
                #kolomButton{
                    position: relative;
                    float: left;
                    display: -webkit-inline-box;
                    padding: 5px;
                    overflow-y: hidden;
                    overflow-x: scroll;
                }
                #kolomButton button,#kolomEditor button,#kolomList select,#kolomButton select,#kolomButton input,#shape{
                    position: relative;
                    float: left;
                    padding: 5px;
                    margin-right: 5px;
                    border-radius: 30px;
                    border: none;
                    width: 50px;
                    height: 50px
                }
                #kolomList #font_family{
                    position: relative;
                    float: left;
                    padding: 5px 10px;
                    margin-right: 5px;
                    border-radius: 30px;
                    border: none;
                    width: auto;
                    height: 50px
                }
                #kolomButton #tang{
                    position: relative;
                    float: left;
                    padding: 5px 10px;
                    margin-right: 5px;
                    border-radius: 30px;
                    border: none;
                    width: auto;
                    height: 50px
                }
                #kolomButton #tang span,#kolomButton #tang strong{
                    position: relative;
                    float: left;
                    width: 100%;
                }
                #kolomList input{
                    position: relative;
                    float: left;
                    height: 100%;
                    padding: 5px;
                    border: none;
                    width: 100%;
                }
                #kolomButton input{
                    color: transparent;
                    overflow: hidden;
                }
                #kolomList button#font_family,#kolomList select{
                    height: 40px
                }
                #kolomList select{
                    width: 40px;
                    padding: 5px
                }
                #style,#textAlign,#alignment,#mirror,#color,#gracolor,#drcolor{
                    position: relative;
                    float: left;
                    margin: 5px;
                    border-radius: 50%;
                    width: 40px;
                    height: 40px;
                    border: none;
                }
                #mirror[value='flip_right']{
                    transform: scaleX(-1);
                }
                #mirror[value='flip_up']{
                    transform: rotate(-90deg);
                }
                #mirror[value='flip_down']{
                    transform: rotate(90deg);
                }
                #color,#gracolor{
                    border: 1px solid #ddd;
                    color: transparent;
                    overflow: hidden;
                }
                #colormatrix #kolom{
                    display: -webkit-inline-box;
                    overflow: scroll;
                }
                .listImg{
                    position: relative;
                    float: left;
                    width: 80px;
                    height: 100px;
                    padding:5px;
                    background-position: center;
                }
                .listImg img,.listImg span,.listImg div{
                    width: 100%;
                    position: relative;
                    float: left;
                    font-size: small;
                    text-align: center;
                    background-size: contain;
                    background-position: center;
                    background-repeat: no-repeat;
                }
                .listImg img,.listImg div{
                    height: 70px;
                    width: 70px;
                }
                .on{
                    background-color: red
                }
                #kolom button#back{
                    padding: 5px;
                    width: 40px;
                    height: 40px;
                }
                #input{
                    width: 100%;
                    position: relative;
                    float: left;
                    min-height: 50px;
                    padding: 5px;
                }
                #input span{
                    width: 100%;
                    display: inline-block;
                    min-height: 40px;
                    max-height: 150px;
                    overflow: scroll;
                    border:1px solid;
                    padding: 7.5px;
                }
        </style>
        <script src="lib/jquery.js"></script>
        <script type="text/javascript" src="lib/shape.js"></script>
  </head>
<body>
    <nav>
        <div class="clear">
            <input type="button" id="clear" class="material-icons" onclick="backe()" value="arrow_back">
        </div>
        <div class="do">
            <input type="button" id="undo" class="material-icons" onclick="imageEditor.undo()" value="undo">
            <input type="button" id="redo" class="material-icons" onclick="imageEditor.redo()" value="redo">
        </div>
        <div class="save">
            <input type="button" id="save" class="material-icons" onclick="imageEditor.downloads()" value="save">
            <input type="button" id="download" class="material-icons" onclick="iklan.video()" value="share">
        </div>
    </nav>
    <input id="btn_image_upload" type="file" accept="image/*" multiple hidden>
    <div class="canvas-holder" id="canvas-holder">
        <canvas id="c"></canvas>
    </div>
    <footer>
        <div id="kolomEx"></div>
        <div id="kolomList"></div>
        <div id="kolomEditor"></div>
        <div id="kolomButton"></div>
    </footer>
    <section class="hiddens">
        <div id="kolomInput">
            <div id="input">
                <span type="text" oninput="imageEditor.textInputs(this)" contenteditable>Type me</span>
            </div>
        </div>
    </section>
</body>
    <script src="lib/fabric.js"></script>
    <script src="vendor/undo-redo-stack.js"></script>
    <script src="lib/utils.js"></script>
    <script src="lib/saveInBrowser.js"></script>
    <script type="text/javascript">
        imageEditor = {
            containerSelector : '#image_editor_container',
            containerEl : $('#image_editor_container'),
            canvas : null,
            activeTool : null,
            activeSelection : null,
            active(a){
              console.log(a)
            },
            init(){
              this.canvas = this.initializeCanvas()
              this.configUndoRedoStack()
            },
            selects(){
              kolomList.innerHTML = ''
              kolomEx.innerHTML = ''
              kolomList.style.display = '-webkit-inline-box'
              kolomList.style.width = `${window.innerWidth-20}px`
              kolomList.style.overflow = 'scroll'
              this.canvas.getObjects().forEach( function(element, index) {
                element.clone(b => {
                  c = document
                  d = c.createElement('div')
                  d.className = 'listImg'
                  d.style.backgroundImage = 'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAHUlEQVQ4jWNgYGAQIYAJglEDhoUBg9+FowbQ2gAARjwKARjtnN8AAAAASUVORK5CYII=")'
                  d.id = index
                  d.setAttribute('onclick',`setA(this)`)
                  d.style.border = '1px solid'
                  e = c.createElement('div')
                  f = b.toDataURL({
                    format: 'png',
                    multiplier: 0.5
                  });
                  e.style.backgroundImage = `url('${f}')`
                  d.appendChild(e)
                  kolomList.appendChild(d)
                })
              });
              this.canvas.discardActiveObject();
              this.canvas.isDrawingLineMode = false;
              this.canvas.isDrawingPathMode = false;
              this.canvas.isDrawingMode = false;
              this.canvas.isDrawingTextMode = false;
              this.canvas.defaultCursor = 'default';
              this.canvas.selection = true;
              this.canvas.renderAll();
              this.canvas.forEachObject(o => {
                o.selectable = true;
                o.evented = true;
              })
            },
            unselects(){
              this.canvas.isDrawingLineMode = false;
              this.canvas.isDrawingPathMode = false;
              this.canvas.isDrawingMode = false;
              this.canvas.isDrawingTextMode = false;
              this.canvas.discardActiveObject();
              this.canvas.renderAll();
              this.activeSelection = null;
            },
            uploads(){
              const processFiles = (files) => {
                for (let file of files) {
                  let reader = new FileReader()
                  if (file.type === 'image/svg+xml') {
                    reader.onload = (f) => {
                      fabric.loadSVGFromString(f.target.result, (objects, options) => {
                        let obj = fabric.util.groupSVGElements(objects, options)
                        obj.set({
                          originY: 'center',
                          originX: 'center',
                          left: this.canvas.width/2,
                          top: this.canvas.height/2
                        })
                        obj.scaleToWidth(this.canvas.width)
                        this.canvas.add(obj)
                        this.canvas.setActiveObject(obj)
                        this.canvas.renderAll()
                        var items = obj._objects;
                        obj._restoreObjectsState();
                        this.canvas.remove(obj);
                        for (var i = 0; i < items.length; i++) {
                          this.canvas.add(items[i]);
                        }
                        this.canvas.renderAll();
                      })
                    }
                    reader.readAsText(file)
                  }else{
                    reader.onload = (f) => {
                      fabric.Image.fromURL(f.target.result, (img) => {
                        img.set({
                          originY: 'center',
                          originX: 'center',
                          left: this.canvas.width/2,
                          top: this.canvas.height/2
                        })
                        img.scaleToWidth(window.innerWidth)
                        this.canvas.add(img)
                        this.canvas.setActiveObject(img)
                        this.canvas.renderAll()
                      })
                    }
                    reader.readAsDataURL(file) 
                  }
                }
              }
              btn_image_upload.onchange = e => processFiles(e.target.files)
              $(`#btn_image_upload`).click();
            },
            sharee(){
                a = this.canvas.toDataURL({
                    format: 'png',
                });
                window.plugins.socialsharing.share(null, 'Mi Al Huda Karangwuni',a, null)
            },
            downloads(){
                a = this.canvas.toDataURL({
                    format: 'png',
                });
                let byteString = a.split(",")[1];
                cordova.plugins.CordovaAndroidMediaStore.store(byteString, "Pictures", `Mi_Al_Huda_Karangwuni_${Date.now()}.png`,b => alert(b), c => alert(c));
            },
            saves(){
                if(!sessionStorage.getItem('file')){
                    file = {
                        id:parseInt(new URLSearchParams(window.location.search).get('id'))
                    }
                }else{
                    file = JSON.parse(sessionStorage.getItem('file'))
                }
                saveInBrowser.save(file.id, this.canvas.toJSON());
            },
            clears(){
              if (window.confirm('This will clear the canvas! Are you sure?')) {
                this.canvas.clear()
              }
            },
            styleBorder(a){
              let style = JSON.parse(a.value)
              this.canvas.getActiveObjects().forEach(obj => obj.set({
                strokeUniform: true,
                strokeDashArray: style.strokeDashArray,
                strokeLineCap: style.strokeLineCap
              }))
              this.canvas.renderAll()
            },
            styleCorner(a){
              this.canvas.getActiveObjects().forEach(obj => obj.set('strokeLineJoin', a.value))
              this.canvas.renderAll()
            },
            updateColors(a){
              if(!this.canvas.freeDrawingBrush){
                this.color = a.value
              }else{
                this.canvas.freeDrawingBrush.color = a.value
                this.canvas.getActiveObjects()[0].set('fill', a.value)
                this.canvas.renderAll()  
              }
            },
            updateDots(a){
              if(!this.canvas.freeDrawingBrush){
                this.dots = a.value
              }else{
                this.canvas.freeDrawingBrush.width = a.value
                this.canvas.getActiveObjects().forEach(obj => obj.set({
                  strokeUniform: true,
                  strokeWidth: a.value
                }))
                this.canvas.renderAll()
              }
            },
            gradientColors(){
              document.querySelector('#gradient_panel').style.display = 'block'
            },
            hapus(){
              this.unselects()
              this.canvas.isDrawingMode = true;
              this.canvas.freeDrawingBrush = new fabric.EraserBrush(this.canvas)
              this.canvas.freeDrawingBrush.width = parseInt(drawsizes.value)
              this.canvas.on('mouse:up', () => {
                this.history.push(JSON.stringify(this.canvas))
              });
            },
            pensils(){
              this.unselects()
              this.canvas.isDrawingMode = true;
              this.canvas.freeDrawingBrush = new fabric.PencilBrush(this.canvas)
              this.canvas.freeDrawingBrush.width = !drawsizes? 1 : parseInt(drawsizes.value)
              this.canvas.freeDrawingBrush.color = drawcolorings.value
              this.canvas.on('mouse:up', () => {
                this.history.push(JSON.stringify(this.canvas))
              });
            },
            sprays(){
              this.unselects()
              this.canvas.isDrawingMode = true;
              this.canvas.freeDrawingBrush = new fabric.SprayBrush(this.canvas)
              this.canvas.freeDrawingBrush.width = parseInt(drawsizes.value)
              this.canvas.freeDrawingBrush.color = drawcolorings.value
              this.canvas.on('mouse:up', () => {
                this.history.push(JSON.stringify(this.canvas))
              });
            },
            circles(){
              this.unselects()
              this.canvas.isDrawingMode = true;
              this.canvas.freeDrawingBrush = new fabric.CircleBrush(this.canvas)
              this.canvas.freeDrawingBrush.width = parseInt(drawsizes.value)
              this.canvas.freeDrawingBrush.color = drawcolorings.value
              this.canvas.on('mouse:up', () => {
                this.history.push(JSON.stringify(this.canvas))
              });
            },
            lines(){
              this.unselects()
              this.canvas.isDrawingLineMode = true;
              this.canvas.defaultCursor = 'crosshair'
              this.canvas.selection = false
              this.canvas.forEachObject(o => {
                o.selectable = false
                o.evented = false
              });
            },
            paths(){
              this.unselects()
              this.canvas.isDrawingPathMode = true
              this.canvas.defaultCursor = 'crosshair'
              this.canvas.selection = false
              this.canvas.forEachObject(o => {
                o.selectable = false
                o.evented = false
              });
            },
            texts(){
              this.unselects()
              this.canvas.isDrawingTextMode = true
              this.canvas.defaultCursor = 'crosshair'
              this.canvas.selection = false
              this.canvas.forEachObject(o => {
                o.selectable = false
                o.evented = false
              });
              this.canvas.isDrawingMode = true;
              let textbox = new fabric.Textbox('Your text goes here...', {
                top:this.canvas.height/2,
                left: this.canvas.width/2,
                width: this.canvas.width/2,
                fontSize: 18,
                fontFamily: "'Open Sans', sans-serif",
                originY: 'center',
                originX: 'center',
              });
              this.canvas.add(textbox)
              this.canvas.setActiveObject(textbox)
              this.canvas.renderAll()
              this.history.push(JSON.stringify(this.canvas))
            },
            backgrounds(){
              this.unselects()
              document.querySelector('#background_panel').style.display = 'block'
            },
            backgroundCanvass(a){
              this.canvas.backgroundColor = a.value
              this.canvas.renderAll();
            },
            getCanvasJSON(){return this.canvas.toJSON()},
            setCanvasJSON(current){
              current && this.canvas.loadFromJSON(JSON.parse(current), this.canvas.renderAll.bind(this.canvas))
            },
            setActiveTool(id){
              let width = 10;
              let color = 'black';
              this.activeTool = id;
              this.canvas.isDrawingLineMode = false;
              this.canvas.isDrawingPathMode = false;
              this.canvas.isDrawingMode = false;
              this.canvas.isDrawingTextMode = false;
              this.canvas.defaultCursor = 'default';
              this.canvas.selection = true;
              this.canvas.forEachObject(o => {
                o.selectable = true;
                o.evented = true;
              })
            },
            undo(){
              let undoList = this.history.getValues().undo;
              if (undoList.length) {
                let current = undoList[undoList.length - 1];
                this.history.undo();
                current && this.canvas.loadFromJSON(JSON.parse(current), this.canvas.renderAll.bind(this.canvas))
              }
            },
            redo(){
              let redoList = this.history.getValues().redo;
              if (redoList.length) {
                let current = redoList[redoList.length - 1];
                this.history.redo();
                current && this.canvas.loadFromJSON(JSON.parse(current), this.canvas.renderAll.bind(this.canvas))
              }
            },
            setActiveSelection(activeSelection){
              this.activeSelection = activeSelection;
              this.setActiveTool('select');
            },
            configUndoRedoStack() {
              this.history = window.UndoRedoStack();
            },
            textInputs(a){
              b = a.innerHTML.replace(/(?:\r\n|\r|\n|<br>)/g, '\n')
              this.canvas.getActiveObject().set({text:b}).setCoords()
              this.canvas.renderAll();
            },
            applyFilter(index, filter) {
              var obj = this.canvas.getActiveObject();
              if(!obj.filters[index]){
                obj.filters[index] = filter;
              }else{
                obj.filters[index] = ''
              }
              obj.applyFilters();
              this.canvas.renderAll();
            },
            resetfilter(){
              var obj = this.canvas.getActiveObject();
              for(i = 0; i < 13 ;i++){
                obj.filters[i] = ''
              }
              obj.applyFilters();
              this.canvas.renderAll();

            },
            getFilter(index) {
              var obj = this.canvas.getActiveObject();
              return obj.filters[index];
            },
            applyFilterValue(index, prop, value) {
              var obj = this.canvas.getActiveObject();
              if (obj.filters[index]) {
                obj.filters[index][prop] = value;
                obj.applyFilters();
                this.canvas.renderAll();
              }
            },
            initializeCanvas() {
              fabricCanvas = new fabric.Canvas('c').setDimensions({
                width: 512,
                height: 512
              })
              fabricCanvas.originalW = 512
              fabricCanvas.originalH = 512
              fabric.Object.prototype.transparentCorners = false;
              fabric.Object.prototype.cornerStyle = 'circle';
              fabric.Object.prototype.borderColor = '#C00000';
              fabric.Object.prototype.cornerColor = '#C00000';
              fabric.Object.prototype.cornerStrokeColor = '#FFF';
              fabric.Object.prototype.padding = 0;
              fabricCanvas.on('selection:created', (e) => {
                this.setActiveSelection(e.target.type)
                if(e.target.type == 'text'||e.target.type == 'textbox'){
                  menuEditor('textEditor')
                }else if(e.target.type == 'polygon'||e.target.type == 'path'||e.target.type == 'circle'){
                  menuEditor('shapeEditor')
                }else if(e.target.type == 'image'){
                  menuEditor('pngEditor')
                }
              })
              fabricCanvas.on('selection:updated', (e) => {
                this.setActiveSelection(e.target.type)
                if(e.target.type == 'text'||e.target.type == 'textbox'){
                  menuEditor('textEditor')
                }else if(e.target.type == 'polygon'||e.target.type == 'path'||e.target.type == 'circle'){
                  menuEditor('shapeEditor')
                }else if(e.target.type == 'image'){
                  menuEditor('pngEditor')
                }
              })
              fabricCanvas.on('selection:cleared', (e) => {
                let currentState = this.canvas.toJSON();
                this.history.push(JSON.stringify(currentState));
                this.setActiveSelection(null)
              })
              fabricCanvas.on('before:selection:cleared', function(e) {
              })
              fabricCanvas.on('object:rotating', (e) => {
                this.setActiveSelection(e.target.type)
                if (e.e.shiftKey) {
                  e.target.snapAngle = 15;
                } else {
                  e.target.snapAngle = false;
                }
              })
              fabricCanvas.on('object:modified', () => {
                for(a of this.canvas.getObjects()){
                  if(a.id == 'top'){
                    this.canvas.remove(a)
                  }else if(a.id == 'left'){
                    this.canvas.remove(a)
                  }
                }
                let currentState = this.canvas.toJSON();
                this.history.push(JSON.stringify(currentState));
              })
              var line9 = new fabric.Line([
                  fabricCanvas.width / 2, 0,
                  fabricCanvas.width / 2, fabricCanvas.width
              ], {
                  strokeDashArray: [5, 5],
                  stroke: 'red',
                  id:'left',
                  selectable : false,
                  evented : false,
                  selected:false,
                  lockMovementY: true,
                  lockMovementX: true,
                  lockUniScaling: true
              })
              var line10 = new fabric.Line([
                  0, fabricCanvas.height / 2,
                  fabricCanvas.width, fabricCanvas.height / 2
              ], {
                  strokeDashArray: [5, 5],
                  stroke: 'red',
                  strokeWidth: 1,
                  id:'top',
                  selectable : false,
                  evented : false,
                  selected:false,
                  lockMovementY: true,
                  lockMovementX: true,
                  lockUniScaling: true
              })
              var snapZone = 5;
              fabricCanvas.on('object:moving', function(options) {
                if(options.target.left > fabricCanvas.width / 2 - snapZone && options.target.left < fabricCanvas.width / 2 + snapZone) {
                  options.target.set({
                    left: fabricCanvas.width / 2
                  }).setCoords();
                  b = 0
                  for(a of fabricCanvas.getObjects()){
                    if(a.id == 'left'){
                      b += 1
                    }
                  }
                  if(!b){
                    fabricCanvas.add(line9);
                  }
                  document.addEventListener("mouseup", () => fabricCanvas.remove(line9));
                }else{
                  fabricCanvas.remove(line9);
                }
                if(options.target.top > fabricCanvas.height / 2 - snapZone && options.target.top < fabricCanvas.height / 2 + snapZone) {
                  options.target.set({
                    top: fabricCanvas.height / 2
                  }).setCoords();
                  b = 0
                  for(a of fabricCanvas.getObjects()){
                    if(a.id == 'top'){
                      b += 1
                    }
                  }
                  if(!b){
                    fabricCanvas.add(line10);
                  }
                  document.addEventListener("mouseup", () => fabricCanvas.remove(line10));
                }else{
                  fabricCanvas.remove(line10);
                }
              });
              if(!window.location.search){

              }else{
                load = parseInt(new URLSearchParams(window.location.search).get('id'))
                const savedCanvas = saveInBrowser.load(load);
                  if (savedCanvas) {
                    fabricCanvas.loadFromJSON(savedCanvas, fabricCanvas.renderAll.bind(fabricCanvas));
                  }
              }
              setTimeout(() => {
                this.saves()
                for(a of fabricCanvas.getObjects()){
                  if(a.id == 'top'){
                    fabricCanvas.remove(a)
                  }else if(a.id == 'left'){
                    fabricCanvas.remove(a)
                  }
                }
                let currentState = fabricCanvas.toJSON();
                this.history.push(JSON.stringify(currentState));
              }, 1000);
              return fabricCanvas;
            },
            initializeShapes(a) {
              _self = this
              fabric.loadSVGFromString(
                a.innerHTML,
                (objects, options) => {
                  var obj = fabric.util.groupSVGElements(objects, options)
                  obj.strokeUniform = true
                  obj.strokeLineJoin = 'miter'
                  obj.set({
                    top:_self.canvas.height/2,
                    left:_self.canvas.width/2,
                    originY: 'center',
                    originX: 'center',
                  })
                  obj.scaleToWidth(100)
                  obj.scaleToHeight(100)
                  _self.canvas.add(obj)
                  _self.canvas.setActiveObject(obj)
                  _self.canvas.renderAll()
                  _self.history.push(JSON.stringify(_self.canvas))
                }
              )
              kolomList.innerHTML = ''
            },
        }
        sistem = async () =>{
            imageEditor.init()
            menuEditor(menuButton)
            document.querySelector('.canvas-container').style.width = `${window.innerWidth}px`
            document.querySelector('.canvas-container').style.height =  `${window.innerWidth}px`
            for(a of document.querySelectorAll('canvas')){
                a.style.width = '100%';
                a.style.height = '100%';
            }
            file = JSON.parse(sessionStorage.getItem('file'))
            if(!localStorage.getItem('file')){
                local = []
            }else{
                local = JSON.parse(localStorage.getItem('file'))
            }
            local.push(file.id)
            localStorage.setItem('file',JSON.stringify(local))
            await fabric.Image.fromURL(file.back, (img) => {
                img.set({
                    originY: 'center',
                    originX: 'center',
                    left: imageEditor.canvas.width/2,
                    top: imageEditor.canvas.height/2
                })
                img.scaleToWidth(imageEditor.canvas.width)
                imageEditor.canvas.add(img)
            })
            fabric.loadSVGFromString(file.fore, (objects, options) => {
                let obj = fabric.util.groupSVGElements(objects, options)
                obj.set({
                    originY: 'center',
                    originX: 'center',
                    left: imageEditor.canvas.width/2,
                    top: imageEditor.canvas.height/2
                })
                obj.scaleToWidth(imageEditor.canvas.width)
                imageEditor.canvas.add(obj)
                var items = obj._objects;
                obj._restoreObjectsState();
                imageEditor.canvas.remove(obj);
                for (var i = 0; i < items.length; i++) {
                    items[i].set({
                        lockMovementY: true,
                        lockMovementX: true,
                        lockScalingX: true,
                        lockScalingY: true,
                        lockSkewingX: true,
                        lockSkewingY: true,
                        lockRotation: true,
                        selectable: false
                    })
                    imageEditor.canvas.add(items[i]);
                }
            })
            imageEditor.canvas.renderAll();
        }
        drawscale = a =>{
            switch (a) {
                case "mode":
                    imageEditor.pensils()
                    break;
                case "brush":
                    imageEditor.sprays()
                    break;
                case "draw":
                    imageEditor.circles()
                    break;
                case "show_chart":
                    imageEditor.lines()
                    break;
                case "timeline":
                    imageEditor.paths()
                    break;
                case "auto_fix_normal":
                    imageEditor.hapus()
                    break;
            }
        }
        drawcoloring = function(a,c){
            setColor = (x,y,z) =>{
                x.value = z
                c.style.backgroundColor = z
                drawscale(y)
                kolomList.innerHTML = ''
            }
            kolomList.innerHTML = ''
            kolomList.style.display = '-webkit-inline-box'
            kolomList.style.overflow = 'scroll'
            kolomList.style.width = `${window.innerWidth}px`
            for(d of col){
                e = document
                f = e.createElement('button')
                f.id = 'drcolor'
                f.style.backgroundColor = d
                f.value = d
                f.setAttribute('onclick',`setColor(${c.id},'${a}','${d}')`)
                kolomList.appendChild(f)
            }
        }
        draws = a =>{
            kolomButton.innerHTML = ''
            b = document
            i = b.createElement('button')
            i.setAttribute('onclick',`backed()`)
            j = b.createElement('span')
            j.className = "material-icons"
            j.innerHTML = "keyboard_arrow_down"
            i.appendChild(j)
            kolomButton.appendChild(i)
            if(a.id != 'erase'){
                c = b.createElement('input')
                c.id = "drawcolorings"
                c.value = "#000000"
                c.style.backgroundColor = "#000000"
                c.setAttribute('onclick',`drawcoloring('${a.children[0].innerHTML}',this)`)
                c.setAttribute('type','button')
                kolomButton.appendChild(c)
            }
            f = b.createElement('select')
            f.id = "drawsizes"
            f.setAttribute('onchange',`drawscale('${a.children[0].innerHTML}')`)
            for(g = 1;g < 50;g++){
                h = b.createElement('option')
                h.value = parseInt(g)
                h.innerHTML = parseInt(g)
                f.appendChild(h)
            }
            kolomButton.appendChild(f)
            drawscale(a.children[0].innerHTML)
        }
        uploaded = () =>{
            chooser.getFile('image/*',file => {
                    if (file.mediaType === 'image/svg+xml') {
                        fabric.loadSVGFromString(file.dataURI, (objects, options) => {
                            let obj = fabric.util.groupSVGElements(objects, options)
                            obj.set({
                                originY: 'center',
                                originX: 'center',
                                left: imageEditor.canvas.width/2,
                                top: imageEditor.canvas.height/2
                            })
                            obj.scaleToWidth(imageEditor.canvas.width)
                            imageEditor.canvas.add(obj)
                            imageEditor.canvas.setActiveObject(obj)
                            imageEditor.canvas.renderAll()
                        })
                    }else{
                        fabric.Image.fromURL(file.dataURI, (img) => {
                            img.set({
                                originY: 'center',
                                originX: 'center',
                                left: imageEditor.canvas.width/2,
                                top: imageEditor.canvas.height/2
                            })
                            img.scaleToWidth(window.innerWidth)
                            imageEditor.canvas.add(img)
                            imageEditor.canvas.setActiveObject(img)
                            imageEditor.canvas.renderAll()
                        })
                    }
            })
        }
        setA = a =>{
            imageEditor.canvas.setActiveObject(imageEditor.canvas.getObjects()[a.id]).renderAll();
        }
        evente = () =>{
            kolomButton.innerHTML = ''
            kolomList.innerHTML = ''
            kolomButton.style.display = '-webkit-inline-box'
            kolomButton.style.overflow = 'scroll'
            kolomButton.style.width = `${window.innerWidth}px`
            b = document
            i = b.createElement('button')
            i.setAttribute('onclick',`backed()`)
            j = b.createElement('span')
            j.className = "material-icons"
            j.innerHTML = "keyboard_arrow_down"
            i.appendChild(j)
            kolomButton.appendChild(i)
            g = b.createElement('button')
            g.setAttribute('onclick',`addNow()`)
            g.id = 'tang'
            h = b.createElement('strong')
            h.innerHTML = new Date().toLocaleString('id-ID',{dateStyle:'full'})
            kolomButton.appendChild(g)
            g.appendChild(h)
            nows = new Date().toLocaleString('id-ID',{month:'numeric'})
            for(a in hari[nows]){
                for(c of hari[nows][a]){
                    d = b.createElement('button')
                    d.setAttribute('onclick',`addEve('${a}','${c}')`)
                    d.id = 'tang'
                    e = b.createElement('span')
                    f = b.createElement('strong')
                    e.innerHTML = a
                    f.innerHTML = c
                    kolomButton.appendChild(d)
                    d.appendChild(e)
                    d.appendChild(f)
                }
            }
        }
        addNow = () =>{
            tah = new Date().toLocaleString('id-ID',{dateStyle:'full'})
            imageEditor.unselects()
            imageEditor.canvas.isDrawingTextMode = true
            imageEditor.canvas.defaultCursor = 'crosshair'
            imageEditor.canvas.selection = false
            imageEditor.canvas.forEachObject(o => {
                o.selectable = false
                o.evented = false
            });
            imageEditor.canvas.isDrawingMode = true;
            let textbox = new fabric.Textbox(tah, {
                top:imageEditor.canvas.height - (imageEditor.canvas.height/8),
                left: imageEditor.canvas.width/2,
                width: imageEditor.canvas.width*3/4,
                fontSize: 36,
                fontFamily: "DINO SKY",
                fontWeight:'bold',
                originY: 'center',
                originX: 'center',
                fill:'#fff000',
                stroke:'#000'
            });
            imageEditor.canvas.add(textbox)
            imageEditor.canvas.setActiveObject(textbox)
            imageEditor.canvas.renderAll()
            imageEditor.history.push(JSON.stringify(imageEditor.canvas))
        }
        addEve = (a,b) =>{
            tah = new Date().toLocaleString('id-ID',{year:'numeric'})
            imageEditor.unselects()
            imageEditor.canvas.isDrawingTextMode = true
            imageEditor.canvas.defaultCursor = 'crosshair'
            imageEditor.canvas.selection = false
            imageEditor.canvas.forEachObject(o => {
                o.selectable = false
                o.evented = false
            });
            imageEditor.canvas.isDrawingMode = true;
            let textbox = new fabric.Textbox(a + ' ' + tah + '\n' + b, {
                top:imageEditor.canvas.height - (imageEditor.canvas.height/8),
                left: imageEditor.canvas.width/2,
                width: imageEditor.canvas.width*3/4,
                fontSize: 24,
                fontFamily: "DINO SKY",
                fontWeight:'bold',
                originY: 'center',
                originX: 'center',
                fill:'#fff000',
                stroke:'#000'
            });
            imageEditor.canvas.add(textbox)
            imageEditor.canvas.setActiveObject(textbox)
            imageEditor.canvas.renderAll()
            imageEditor.history.push(JSON.stringify(imageEditor.canvas))
        }
        scrolls = function(){
            kolomButton.innerHTML = ''
            kolomList.innerHTML = ''
            kolomButton.style.display = '-webkit-inline-box'
            kolomButton.style.overflow = 'scroll'
            kolomButton.style.width = `${window.innerWidth}px`
            b = document
            i = b.createElement('button')
            i.setAttribute('onclick',`backed()`)
            j = b.createElement('span')
            j.className = "material-icons"
            j.innerHTML = "keyboard_arrow_down"
            i.appendChild(j)
            kolomButton.appendChild(i)
            for(a of shapeList){
                c = b.createElement('div')
                c.style.backgroundImage = 'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAHUlEQVQ4jWNgYGAQIYAJglEDhoUBg9+FowbQ2gAARjwKARjtnN8AAAAASUVORK5CYII=")'
                c.id = 'shape'
                c.className = 'button'
                c.innerHTML = a
                c.setAttribute('onclick',`imageEditor.initializeShapes(this)`)
                kolomButton.appendChild(c)
            }
        }
        effe = function(a,b){
            kolomList.innerHTML = ''
            kolomList.style.display = '-webkit-inline-box'
            kolomList.style.overflow = 'scroll'
            kolomList.style.width = `${window.innerWidth}px`
            images = imageEditor.canvas.getActiveObject()
            switch (b) {
                case 'colormatrix':
                    i = []
                    for(j in images.filters){
                        i.push(j)
                    }
                    fil.forEach( function(c, d) {
                        images.clone(cl => {
                            cl.filters = []
                            cl.filters[d] = eval(c[0])
                            if(c[2]){
                                cl.filters[d]['mode'] = c[1]
                            }
                            cl.applyFilters();
                            e = document
                            f = e.createElement('div')
                            f.className = 'listImg ' + (!i.find(element => element == d)? '' : 'on')
                            f.id = c[1]
                            f.setAttribute('onclick',`filtes(this)`)
                            g = e.createElement('img')
                            h = e.createElement('span')
                            h.innerHTML = !c[1]? 'Default' : c[1]
                            g.src = cl.toDataURL({
                                format: 'png',
                                multiplier: 0.3
                            });
                            kolomList.appendChild(f)
                            f.appendChild(g)
                            f.appendChild(h)
                        })
                    });
                    break;
                case 'tune':
                    tunes = ['Brightness','Contrast','Hue','Noise','Pixelate','Saturation']
                    for(d of tunes){
                        e = document
                        f = e.createElement('button')
                        f.setAttribute('onclick',`show(this,'${d}')`)
                        f.innerHTML = d
                        kolomList.appendChild(f)
                    }
                    break;
                }
        }
        serColoring = (a,b)=>{
            imageEditor.canvas.getActiveObject().set(a,b)
            imageEditor.canvas.renderAll()
            kolomEx.innerHTML = ''
            kolomList.innerHTML = ''
        }
        serGraColor = (a,b) =>{
            g = []
            d = b.value.split(',')
            for(e of d){
                f = e.split(':')
                g.push(f)
            }
            i = []
            for(h of g){
                if(h.length == 1){
                    angle = h[0]
                }else{
                    i.push({color : h[0],position : h[1]})
                }
            }
            gradient = generateFabricGradientFromColorStops(i,imageEditor.canvas.getActiveObject().width,imageEditor.canvas.getActiveObject().height, 'linear', angle);
            imageEditor.canvas.getActiveObject().set(a, gradient);
            imageEditor.canvas.renderAll()
            kolomEx.innerHTML = ''
            kolomList.innerHTML = ''
        }
        coloring = function(a,b){
            kolomEx.innerHTML = ''
            kolomEx.style.display = '-webkit-inline-box'
            kolomEx.style.overflow = 'scroll'
            kolomEx.style.width = `${window.innerWidth}px`
            if(!b){
                for(d of gracol){
                    e = document
                    f = e.createElement('button')
                    f.id = 'gracolor'
                    f.style.backgroundImage = d[0]
                    f.setAttribute('onclick',`serGraColor('${a}',this)`)
                    f.value = d[1]
                    kolomEx.appendChild(f)
                }
            }else{
                e = document
                f = e.createElement('button')
                f.id = 'gracolor'
                f.style.backgroundImage = 'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAHUlEQVQ4jWNgYGAQIYAJglEDhoUBg9+FowbQ2gAARjwKARjtnN8AAAAASUVORK5CYII=")'
                f.setAttribute('onclick',`serColoring('${a}','transparent')`)
                f.value = d[1]
                kolomEx.appendChild(f)
            }
            kolomList.innerHTML = ''
            kolomList.style.display = '-webkit-inline-box'
            kolomList.style.overflow = 'scroll'
            kolomList.style.width = `${window.innerWidth}px`
            for(d of col){
                e = document
                f = e.createElement('button')
                f.id = 'color'
                f.style.backgroundColor = d
                f.value = d
                f.setAttribute('onclick',`serColoring('${a}','${d}')`)
                kolomList.appendChild(f)
            }
        }

        setStyling = a =>{
            for(b of imageEditor.canvas.getActiveObjects()){
                switch (a) {
                  case 'bold':
                    setActiveFontStyle(b, 'fontWeight', getActiveFontStyle(b, 'fontWeight') === 'bold' ? '' : 'bold')
                    break;
                  case 'italic':
                    setActiveFontStyle(b, 'fontStyle', getActiveFontStyle(b, 'fontStyle') === 'italic' ? '' : 'italic')
                    break;
                  case 'underline':
                    setActiveFontStyle(b, 'underline', !getActiveFontStyle(b, 'underline'))
                    break;
                  case 'linethrough':
                    setActiveFontStyle(b, 'linethrough', !getActiveFontStyle(b, 'linethrough'))
                    break;
                  case 'overline':
                    setActiveFontStyle(b, 'overline', !getActiveFontStyle(b, 'overline'))
                    break;
                }
            }
            imageEditor.canvas.renderAll()
        }
        setFontFamily = a =>{
          for(b of imageEditor.canvas.getActiveObjects()){
            setActiveFontStyle(b, 'fontFamily', a)
            imageEditor.canvas.renderAll()
          }
        }
        setFontAlign = a =>{
            for(b of imageEditor.canvas.getActiveObjects()){
                setActiveFontStyle(b, a.id, a.value);
                imageEditor.canvas.renderAll()
            }
        }
        setAlign = a =>{
            for(b of imageEditor.canvas.getActiveObjects()){
                alignObject(imageEditor.canvas,b, a)
                imageEditor.canvas.renderAll()
            }
        }
        setFlip = a =>{
          for(b of imageEditor.canvas.getActiveObjects()){
            switch (a) {
              case 'flip_left':
                b.set('flipX',false);
                break;
              case 'flip_right':
                b.set('flipX',true);
                break;
              case 'flip_up':
                b.set('flipY',false);
                break;
              case 'flip_down':
                b.set('flipY',true);
                break;
              default:
                break;
            }
          }
          imageEditor.canvas.renderAll()
        }
        setRange = a =>{
          for(b of imageEditor.canvas.getActiveObjects()){
            b.set(a.id,parseFloat(a.value)).setCoords()
            imageEditor.canvas.renderAll()
          }
        }
        setZoom = a =>{
          for(b of imageEditor.canvas.getActiveObjects()){
            b.set({
              scaleX: parseFloat(a.value),
              scaleY: parseFloat(a.value)
            }).setCoords()
            imageEditor.canvas.renderAll()
          }
        }
        show = function(a,b){
            kolomEx.innerHTML = ''
            kolomList.innerHTML = ''
            kolomList.style.display = '-webkit-inline-box'
            kolomList.style.overflow = 'scroll'
            kolomList.style.width = `${window.innerWidth}px`
            d = document
            switch (b) {
                case 'Brightness':
                    f = d.createElement('input')
                    f.id = "brightness"
                    f.setAttribute('onchange',`filtes(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`-1`)
                    f.setAttribute('max',`1`)
                    f.setAttribute('step',`0.003921`)
                    f.value = '0.1'
                    kolomList.appendChild(f)
                    break;
                case 'Contrast':
                    f = d.createElement('input')
                    f.id = "contrast"
                    f.setAttribute('onchange',`filtes(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`-1`)
                    f.setAttribute('max',`1`)
                    f.setAttribute('step',`0.003921`)
                    f.value = '0.1'
                    kolomList.appendChild(f)
                    break;
                case 'Hue':
                    f = d.createElement('input')
                    f.id = "hue"
                    f.setAttribute('onchange',`filtes(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`-2`)
                    f.setAttribute('max',`2`)
                    f.setAttribute('step',`0.002`)
                    f.value = '0'
                    kolomList.appendChild(f)
                    break;
                case 'Noise':
                    f = d.createElement('input')
                    f.id = "noise"
                    f.setAttribute('onchange',`filtes(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`0`)
                    f.setAttribute('max',`1000`)
                    f.value = '100'
                    kolomList.appendChild(f)
                    break;
                case 'Pixelate':
                    f = d.createElement('input')
                    f.id = "pixelate"
                    f.setAttribute('onchange',`filtes(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`2`)
                    f.setAttribute('max',`20`)
                    f.value = '4'
                    kolomList.appendChild(f)
                    break;
                case 'Saturation':
                    f = d.createElement('input')
                    f.id = "saturation"
                    f.setAttribute('onchange',`filtes(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`-1`)
                    f.setAttribute('max',`1`)
                    f.setAttribute('step',`0.003921`)
                    f.value = '0'
                    kolomList.appendChild(f)
                    break;
                case 'fontSizes':
                    f = d.createElement('select')
                    f.id = "fontSize"
                    f.setAttribute('onchange',`setFontAlign(this)`)
                    for(g = 1;g < 150;g++){
                        h = d.createElement('option')
                        h.value = g
                        h.innerHTML = g
                        f.appendChild(h)
                    }
                    f.value = imageEditor.canvas.getActiveObject().fontSize
                    kolomList.appendChild(f)
                    break;
                case 'fontHeight':
                    f = d.createElement('select')
                    f.id = "lineHeight"
                    f.setAttribute('onchange',`setFontAlign(this)`)
                    for(g = 1;g < 30;g++){
                        h = d.createElement('option')
                        h.value = g/10
                        h.innerHTML = g/10
                        f.appendChild(h)
                    }
                    f.value = imageEditor.canvas.getActiveObject().lineHeight
                    kolomList.appendChild(f)
                    break;
                case 'fontSpace':
                    f = d.createElement('select')
                    f.id = "charSpacing"
                    f.setAttribute('onchange',`setFontAlign(this)`)
                    for(g = 1;g < 20;g++){
                        h = d.createElement('option')
                        h.value = g*100
                        h.innerHTML = g*100
                        f.appendChild(h)
                    }
                    f.value = imageEditor.canvas.getActiveObject().charSpacing
                    kolomList.appendChild(f)
                    break;
                case 'opacitys':
                    kolomList.style.display = 'block'
                    kolomList.style.width = '100%'
                    f = d.createElement('input')
                    f.id = "opacity"
                    f.setAttribute('onchange',`setRange(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`0`)
                    f.setAttribute('max',`1`)
                    f.setAttribute('step',`0.01`)
                    f.value = imageEditor.canvas.getActiveObject().opacity
                    kolomList.appendChild(f)
                    break;
                case 'rotates':
                    kolomList.style.display = 'block'
                    kolomList.style.width = '100%'
                    f = d.createElement('input')
                    f.id = "angle"
                    f.setAttribute('onchange',`setRange(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`-100`)
                    f.setAttribute('max',`180`)
                    f.setAttribute('step',`1`)
                    f.value = imageEditor.canvas.getActiveObject().rotate
                    kolomList.appendChild(f)
                    break;
                case 'scaling':
                    kolomList.style.display = 'block'
                    kolomList.style.width = '100%'
                    f = d.createElement('input')
                    f.id = "scales"
                    f.setAttribute('onchange',`setZoom(this)`)
                    f.setAttribute('type',`range`)
                    f.setAttribute('min',`0`)
                    f.setAttribute('max',`4`)
                    f.setAttribute('step',`0.1`)
                    f.value = 1
                    kolomList.appendChild(f)
                    break;
                case 'listStyle':
                    for(c of eval(b)){
                        e = d.createElement('button')
                        e.id = 'style'
                        e.value = c[0]
                        e.innerHTML = c[1]
                        e.className = 'material-icons'
                        e.setAttribute(('onclick'),`setStyling('${c[0]}')`)
                        kolomList.appendChild(e)
                    }
                    break;
                case 'listFont':
                    for(c of eval(b)){
                        e = d.createElement('button')
                        e.id = 'font_family'
                        e.value = c[0]
                        e.innerHTML = c[1]
                        e.setAttribute(('onclick'),`setFontFamily('${c[0]}')`)
                        e.style.fontFamily = c[0]
                        kolomList.appendChild(e)
                    }
                    break;
                case 'listAlign':
                    for(c of eval(b)){
                        e = d.createElement('button')
                        e.id = 'textAlign'
                        e.value = c[0]
                        e.className = 'material-icons'
                        e.innerHTML = c[1]
                        e.setAttribute(('onclick'),`setFontAlign(this)`)
                        kolomList.appendChild(e)
                    }
                    break;
                case 'position':
                    for(c of eval(b)){
                        e = d.createElement('button')
                        e.id = 'alignment'
                        e.value = c[0]
                        e.className = 'material-icons'
                        e.innerHTML = c[1]
                        e.setAttribute(('onclick'),`setAlign('${c[0]}')`)
                        kolomList.appendChild(e)
                    }
                    break;
                case 'mirrors':
                    for(c of eval(b)){
                        e = d.createElement('button')
                        e.id = 'mirror'
                        e.value = c
                        e.className = 'material-icons'
                        e.innerHTML = 'flip'
                        e.setAttribute(('onclick'),`setFlip('${c}')`)
                        kolomList.appendChild(e)
                    }
                    break;
                default:
                    break;
            }
        }
        backed = ()=>{
            imageEditor.unselects()
            kolomEx.innerHTML =''
            kolomList.innerHTML =''
            kolomButton.innerHTML =''
            kolomEditor.innerHTML = ''
            menuEditor(menuButton)
        }
        filtes = function(a){
            a.classList.toggle('on')
            switch (a.id) {
                case 'average':
                    imageEditor.applyFilter(1,new fabric.Image.filters.Grayscale());
                    imageEditor.applyFilterValue(1, 'mode', 'average');
                    break;
                case 'luminosity':
                    imageEditor.applyFilter(2,new fabric.Image.filters.Grayscale());
                    imageEditor.applyFilterValue(2, 'mode', 'luminosity');
                    break;
                case 'lightness':
                    imageEditor.applyFilter(3,new fabric.Image.filters.Grayscale());
                    imageEditor.applyFilterValue(3, 'mode', 'lightness');
                    break;
                case 'invert':
                    imageEditor.applyFilter(4,new fabric.Image.filters.Invert());
                    break;
                case 'sepia':
                    imageEditor.applyFilter(5,new fabric.Image.filters.Sepia());
                    break;
                case 'brownie':
                    imageEditor.applyFilter(6,new fabric.Image.filters.Brownie());
                    break;
                case 'kodachrome':
                    imageEditor.applyFilter(7,new fabric.Image.filters.Kodachrome());
                    break;
                case 'blackwhite':
                    imageEditor.applyFilter(8,new fabric.Image.filters.BlackWhite());
                    break;
                case 'technicolor':
                    imageEditor.applyFilter(9,new fabric.Image.filters.Technicolor());
                    break;
                case 'vintage':
                    imageEditor.applyFilter(10,new fabric.Image.filters.Vintage());
                    break;
                case 'polaroid':
                    imageEditor.applyFilter(11,new fabric.Image.filters.Polaroid());
                    break;
                case 'sharpen':
                    imageEditor.applyFilter(12,new fabric.Image.filters.Convolute({matrix: [  0, -1,  0,-1,  5, -1,0, -1,  0 ]}));
                    break;
                case 'emboss':
                    imageEditor.applyFilter(13,new fabric.Image.filters.Convolute({matrix: [ 1,   1,  1,1, 0.7, -1,-1,  -1, -1 ]}));
                    break;
                case 'brightness':
                    imageEditor.applyFilter(14,new fabric.Image.filters.Brightness({brightness: parseFloat(a.value)}));
                    break;
                case 'contrast':
                    imageEditor.applyFilter(15, new fabric.Image.filters.Contrast({contrast: parseFloat(a.value)}));
                    break;
                case 'saturation':
                    imageEditor.applyFilter(16,new fabric.Image.filters.Saturation({saturation: parseFloat(a.value)}));
                    break;
                case 'noise':
                    imageEditor.applyFilter(17, new fabric.Image.filters.Noise({noise: parseInt(a.value, 10)}));
                    break;
                case 'blocksize':
                    imageEditor.applyFilter(18,new fabric.Image.filters.Pixelate({blocksize: parseInt(a.value, 10)}));
                    break;
                case 'rotation':
                    imageEditor.applyFilter(19,new fabric.Image.filters.HueRotation({rotation: a.value,}));
                    break;
                default:
                    for(b of document.querySelectorAll('.listImg')){
                        b.className = 'listImg'
                    }
                    imageEditor.resetfilter()
                    break;
            }
        }
        menuEditor = a =>{
            kolomEx.innerHTML =''
            kolomList.innerHTML =''
            kolomButton.innerHTML =''
            kolomEditor.innerHTML = ''
            kolomButton.style.width = `${window.innerWidth}px`
            b = document
            for(c of eval(a)){
                d = b.querySelector(c[0])
                e = b.createElement(c[1])
                for(f in c[2]){
                    e.setAttribute(f,c[2][f])
                }
                e.innerHTML = !c[3]? '' : c[3]
                d.appendChild(e)
            }
        }
        bring_fwd = () => {
          for(b of imageEditor.canvas.getActiveObjects()){
            imageEditor.canvas.bringForward(b)
            imageEditor.canvas.renderAll()
          }
        }
        bring_back = () => {
          for(b of imageEditor.canvas.getActiveObjects()){
            imageEditor.canvas.sendBackwards(b)
            imageEditor.canvas.renderAll()
          }
        }
        duplicate = () => {
          let clonedObjects = []
          let activeObjects = imageEditor.canvas.getActiveObjects()
          activeObjects.forEach(obj => {
            obj.clone(clone => {
              imageEditor.canvas.add(clone.set({
                strokeUniform: true,
                left: obj.aCoords.tl.x + 20,
                top: obj.aCoords.tl.y + 20
              }));

              if (activeObjects.length === 1) {
                imageEditor.canvas.setActiveObject(clone)
              }
              clonedObjects.push(clone)
            })
          })
          if (clonedObjects.length > 1) {
            let sel = new fabric.ActiveSelection(clonedObjects, {
              canvas: imageEditor.canvas,
            });
            imageEditor.canvas.setActiveObject(sel)
          }
          imageEditor.canvas.requestRenderAll()
        }
        deletes = () => {
          imageEditor.canvas.getActiveObjects().forEach(obj => imageEditor.canvas.remove(obj))
          imageEditor.canvas.discardActiveObject().requestRenderAll()
        }
        opacity = a => {
          imageEditor.canvas.getActiveObject().set('opacity',parseFloat(a.value)).setCoords()
          imageEditor.canvas.renderAll()
        }
        rotate = a =>{
          for(b of imageEditor.canvas.getActiveObjects()){
            b.set('angle',parseFloat(a.value)).setCoords()
            imageEditor.canvas.renderAll()
          }
        }
        scales = a => {
          for(b of imageEditor.canvas.getActiveObjects()){
            b.set({
              scaleX: parseFloat(a.value),
              scaleY: parseFloat(a.value)
            }).setCoords()
            imageEditor.canvas.renderAll()
          }
        }
        shadow = () =>{
          for(b of imageEditor.canvas.getActiveObjects()){
            if (b.shadow) {
              b.shadow = null;
            }
            else {
              b.setShadow({
                color: 'rgba(0,0,0,0.3)',
                blur: 10,
                offsetX: 10,
                offsetY: 10
              });
            }
            imageEditor.canvas.renderAll()
          }
        }
        backe = () =>{
            window.location.replace(`index.html`)
        }
        document.addEventListener("backbutton", backe, false)
        document.addEventListener('deviceready',sistem , false);
    </script>
</html>